---
title: "Crypto Cointegration"
author: "Manuel Hanuch"
output: pdf_document
---


Welcome to My ORIE 5640 final Project. In this notebook, I will be exploring time series of crypto assets to see if there is any cointegration amongst them. I was able to find standardized daily level data for a variety of different cryptocurrencies from Kaggle, and wrote a script in Python (get_data.py)to select and combine the different assets into one csv file. We will be trying to find several different relationships, so this script will come in handy. 

Lets start off with some EDA. 


```{r,fig.width=7,fig.height = 5}
allcoins = read.csv('allcoins.csv')


par(mfrow=c(4,6))

for(i in colnames(allcoins)[-1]){
  plot(allcoins[[i]],type = 'l',ylab = i)
  
}

```


So here are all the time series. I notice that BTC ands WBTC are extremely similar. The reason for that, in short, is because WBTC is "an ERC-20 token that represents Bitcoin (BTC) on the Ethereum blockchain. A key advantage of WBTC is its integration into the world of Ethereum wallets, dapps, and smart contracts." With that in mind,WBTC is meant to have the exact same value as BTC. However, due to market forces, their value is not always exactly the same. I suspect that the prices may be cointegrated. lets explore this further. Perhaps there is potential for a trading strategy!

```{r}
library(tseries)
library(urca)
```

```{r}
btc.wbtc = read.csv('btc_wbtc.csv')
date = btc.wbtc[['Date']]
par(mfrow=c(2,1))
plot(btc.wbtc$BTC,type = 'l',col='blue')
plot(btc.wbtc$WBTC,type = 'l',col = 'red')

```

Above is a clearer picture of how similar the time series are. First, lets regress WBTC prices on BTC since BTC is the original.

```{r}
btc.wbtc.lm = lm(WBTC ~ BTC, data = btc.wbtc )
print(btc.wbtc.lm$coefficients)

plot(residuals(btc.wbtc.lm),type='l')
```
Wow, these resuduals definitely seem mean reverting!


Below, lets use the phillips-Ouliaris test as a first pass.

```{r}
btc.wbtc= btc.wbtc[c('BTC','WBTC')]

po.test(btc.wbtc,lshort = TRUE)

```

the small p-value may suggest evidence that these prices are cointegrated. 

Next lets check vecm using johansen procedure
```{r}


options(digits=3,width=60)
btc.wbtc.cajo = ca.jo(btc.wbtc)
summary(btc.wbtc.cajo)


```

Strange, its telling us there are no cointegrating vectors. However, I think its worth noting that one of the cointegration vectors that it found is just the difference between the two series. this makes sense, since the nature of the two coins is that they should be exactly equal in value, ie that the differnce between the two series is stationary.


```{r}
par(mfrow=c(2,1))
plot(as.Date(date),as.matrix(btc.wbtc)%*% btc.wbtc.cajo@V[,1],type="l",ylab="first projection")
plot(as.Date(date),as.matrix(btc.wbtc)%*%btc.wbtc.cajo@V[,2],type="l",ylab="second projection")
```



First one looks stationary. Lets test using adf and kpss.
```{r}
adf.test(as.matrix(btc.wbtc)%*% btc.wbtc.cajo@V[,1])
kpss.test(as.matrix(btc.wbtc)%*% btc.wbtc.cajo@V[,1])
```

And it is worth noting that the KPSS and ADF test agree that the process is stationary.


what if we  try log prices on all of this
```{r}
#take the log of the time series
l.btc.wbtc = log(btc.wbtc)

#regress log prices on one another and plot residuals
l.btc.wbtc.lm = lm(WBTC ~ BTC, data = l.btc.wbtc )
print(l.btc.wbtc.lm$coefficients)
plot(residuals(l.btc.wbtc.lm),type='l')

#po test on log prices
po.test(l.btc.wbtc)

#verc on log prices
options(digits=3,width=60)
l.btc.wbtc.cajo = ca.jo(l.btc.wbtc)
summary(l.btc.wbtc.cajo)

#plot vecm
par(mfrow=c(2,1))
plot(as.Date(date),as.matrix(l.btc.wbtc)%*% l.btc.wbtc.cajo@V[,1],type="l",ylab="first projection")
plot(as.Date(date),as.matrix(l.btc.wbtc)%*% l.btc.wbtc.cajo@V[,2],type="l",ylab="second projection")

#run stationarity tests on series with cointegrated vector
adf.test(as.matrix(l.btc.wbtc)%*% l.btc.wbtc.cajo@V[,1])
kpss.test(as.matrix(l.btc.wbtc)%*% l.btc.wbtc.cajo@V[,1])

```

Pretty much the same result. 



I think on some level, it safe to say that these processes are cointegrated. That said





